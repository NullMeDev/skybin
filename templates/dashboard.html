{% extends "base.html" %}

{% block content %}
<div class="content-card">
    <h3>Recent Pastes</h3>
    <div style="overflow-x: auto;">
        <table class="table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Language</th>
                    <th>Source</th>
                    <th>Created</th>
                </tr>
            </thead>
            <tbody id="recent-tbody">
                <tr>
                    <td colspan="4" style="text-align: center; color: #9ca3af;">Loading...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    // Fetch recent pastes
    async function loadRecentPastes() {
        try {
            const response = await fetch('/api/pastes');
            const data = await response.json();
            
            if (data.success && data.data) {
                const pastes = data.data.slice(0, 10);
                
                const pasteRows = pastes.map(paste => {
                    const date = new Date(paste.created_at * 1000).toLocaleDateString();
                    const title = paste.title || '(No Title)';
                    const language = paste.syntax || 'Plaintext';
                    
                    return `
                        <tr style="cursor: pointer;" onclick="window.location='/paste/${paste.id}'">
                            <td><a href="/paste/${paste.id}" style="color: inherit; text-decoration: none;">${title}</a></td>
                            <td>${language}</td>
                            <td>${paste.source}</td>
                            <td>${date}</td>
                        </tr>
                    `;
                }).join('');
                
                document.getElementById('recent-tbody').innerHTML = pasteRows || '<tr><td colspan="4" style="text-align: center; color: #9ca3af;">No pastes yet</td></tr>';
            }
        } catch (error) {
            console.error('Failed to load recent pastes:', error);
        }
    }
    
    // Load data on page load
    loadRecentPastes();
    
    // Refresh every 30 seconds
    setInterval(loadRecentPastes, 30000);
</script>
{% endblock %}
