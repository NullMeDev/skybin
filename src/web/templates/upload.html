{% extends "base.html" %}

{% block content %}
<div class="content-card">
    <h3>Submit a Paste</h3>
    
    <form id="uploadForm" style="max-width: 800px;">
        <div class="form-group">
            <label for="title">Title (Optional)</label>
            <input type="text" id="title" name="title" placeholder="Give your paste a title..." maxlength="255">
        </div>
        
        <div class="form-group">
            <label for="content">Content</label>
            <textarea id="content" name="content" placeholder="Paste your content here..." required></textarea>
        </div>
        
        <div class="form-group">
            <label for="syntax">Syntax Highlighting</label>
            <select id="syntax" name="syntax">
                <option value="">Auto-detect</option>
                <option value="plaintext">Plain Text</option>
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
                <option value="rust">Rust</option>
                <option value="json">JSON</option>
                <option value="xml">XML</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="bash">Bash</option>
                <option value="sql">SQL</option>
                <option value="c">C</option>
                <option value="cpp">C++</option>
                <option value="go">Go</option>
                <option value="java">Java</option>
                <option value="php">PHP</option>
                <option value="ruby">Ruby</option>
            </select>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn btn-primary">Submit Paste</button>
            <button type="reset" class="btn btn-secondary">Clear</button>
        </div>
    </form>
    
    <div id="message" style="margin-top: 20px;"></div>
</div>

<div class="content-card" style="max-width: 800px;">
    <h3>Features</h3>
    <ul style="margin-left: 20px; line-height: 2;">
        <li>üìù <strong>Anonymous Submission</strong> - No account needed</li>
        <li>üîí <strong>Auto-Deletion</strong> - Pastes expire after 7 days</li>
        <li>üîç <strong>Pattern Detection</strong> - Automatically detects sensitive data</li>
        <li>üåê <strong>Syntax Highlighting</strong> - Choose or auto-detect language</li>
        <li>‚ö° <strong>Fast Search</strong> - Full-text search across all pastes</li>
    </ul>
</div>

<script>
    const form = document.getElementById('uploadForm');
    const messageDiv = document.getElementById('message');
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = {
            title: document.getElementById('title').value || null,
            content: document.getElementById('content').value,
            syntax: document.getElementById('syntax').value || null
        };
        
        if (!formData.content.trim()) {
            showMessage('Content cannot be empty', 'alert-danger');
            return;
        }
        
        try {
            const response = await fetch('/upload', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const data = await response.json();
            
            if (response.ok && data.success) {
                const pasteId = data.data;
                showMessage(`‚úì Paste submitted successfully! <a href="/paste/${pasteId}" style="color: #3b82f6; font-weight: bold;">View it here</a>`, 'alert-success');
                form.reset();
            } else {
                showMessage(`Error: ${data.error || 'Failed to submit paste'}`, 'alert-danger');
            }
        } catch (error) {
            showMessage(`Error: ${error.message}`, 'alert-danger');
        }
    });
    
    function showMessage(text, className) {
        messageDiv.innerHTML = `<div class="alert ${className}">${text}</div>`;
        messageDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
</script>
{% endblock %}
