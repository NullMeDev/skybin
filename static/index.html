<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyBin</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/styles.css">
    <!-- HTMX for partial page updates -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <!-- Alpine.js for reactive UI state -->
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
</head>
<body>
    <nav>
        <div class="container">
<a href="/" class="logo">SkyBin <span>v2.5.0</span></a>
            <ul class="nav-links">
                <li><a href="/" class="active">Feed</a></li>
                
                
                <li><a href="/changelog">Changelog</a></li>
                <li><a href="/disclaimer">Disclaimer</a></li>
                <li><a href="https://github.com/NullMeDev/skybin" target="_blank">GitHub</a></li>
            </ul>
            <a href="/upload" class="btn btn-primary btn-sm">New Paste</a>
        </div>
    </nav>

    <main class="page">
        <div class="container">
            <div class="page-header">
                <h1>Paste Feed</h1>
                <p>Real-time aggregation from public paste sites</p>
            </div>

            <!-- HTMX-powered stats bar - auto-refreshes every 30s -->
            <div class="stats-bar" id="stats-bar"
                 hx-get="/api/stats/html"
                 hx-trigger="load, every 30s"
                 hx-swap="innerHTML">
                <!-- Skeleton loaders shown initially -->
                <div class="stat skeleton-stat"></div>
                <div class="stat skeleton-stat"></div>
                <div class="stat skeleton-stat"></div>
                <div class="stat skeleton-stat"></div>
            </div>

            <!-- Search bar replaces filter tabs -->
            <div class="search-container" style="margin-bottom: 24px;">
                <form action="/search" method="get" style="display: flex; gap: 8px;">
                    <input type="search" 
                           name="q" 
                           placeholder="Search pastes by content, service, or credential type..." 
                           class="search-input"
                           style="flex: 1; padding: 12px 16px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;"
                           autofocus>
                    <button type="submit" class="btn btn-primary">Search</button>
                </form>
            </div>

            <!-- HTMX-powered paste container with infinite scroll -->
            <div id="paste-container"
                 hx-get="/api/pastes/html"
                 hx-trigger="load, every 30s"
                 hx-swap="innerHTML">
                <!-- Skeleton loaders shown initially -->
                <div class="paste-list">
                    <div class="skeleton-paste"></div>
                    <div class="skeleton-paste"></div>
                    <div class="skeleton-paste"></div>
                    <div class="skeleton-paste"></div>
                    <div class="skeleton-paste"></div>
                </div>
            </div>

            <!-- Pagination removed - using infinite scroll via HTMX -->
        </div>
    </main>

    <!-- Alpine.js Sources Modal -->
    <div x-data="sourcesModal()" @keydown.escape.window="open = false">
        <!-- Modal Backdrop -->
        <div x-show="open" x-transition:enter="transition ease-out duration-200" 
             x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
             @click="open = false"
             style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;"
             :style="open ? 'display: flex' : 'display: none'">
            <!-- Modal Content -->
            <div @click.stop style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 70vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="color: var(--text-primary);">Source Status</h3>
                    <button @click="open = false" style="background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer;">&times;</button>
                </div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <template x-for="source in sources" :key="source.name">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: var(--bg-primary); border-radius: 6px;">
                            <span style="color: var(--text-primary);" x-text="source.label"></span>
                            <span :style="'color: ' + (source.active ? '#00ff88' : '#888') + '; font-size: 12px;'">
                                ● <span x-text="source.active ? 'Active' : 'Idle'"></span>
                            </span>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div style="display: flex; align-items: center; gap: 8px;">Made with <span style="color: #ff6b6b;">❤</span> by <a href="https://github.com/NullMeDev" target="_blank" style="color: var(--primary);">NullMeDev</a></div>
                <ul class="footer-links">
                    <li><a href="/status">Status</a></li>
                    <li><a href="https://github.com/NullMeDev/skybin" target="_blank">GitHub</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        // Alpine.js component for sources modal
        function sourcesModal() {
            return {
                open: false,
                sources: [
                    { name: 'pastebin', label: 'Pastebin', active: false },
                    { name: 'gists', label: 'GitHub Gists', active: false },
                    { name: 'ideone', label: 'Ideone', active: false },
                    { name: 'paste_ee', label: 'Paste.ee', active: false },
                    { name: 'rentry', label: 'Rentry', active: false },
                    { name: 'dpaste', label: 'dpaste', active: false },
                    { name: 'hastebin', label: 'Hastebin', active: false },
                    { name: 'slexy', label: 'Slexy', active: false },
                    { name: 'ubuntu_pastebin', label: 'Ubuntu Pastebin', active: false },
                    { name: 'justpaste', label: 'JustPaste', active: false },
                    { name: 'controlc', label: 'ControlC', active: false },
                    { name: 'pastecode', label: 'Pastecode', active: false },
                    { name: 'dpaste_org', label: 'dpaste.org', active: false },
                    { name: 'defuse', label: 'Defuse', active: false },
                    { name: 'codepad', label: 'Codepad', active: false },
                    { name: 'bpaste', label: 'bpaste', active: false },
                    { name: 'termbin', label: 'Termbin', active: false },
                    { name: 'sprunge', label: 'Sprunge', active: false },
                    { name: 'paste_rs', label: 'paste.rs', active: false },
                    { name: 'paste2', label: 'Paste2', active: false },
                    { name: 'pastebin_pl', label: 'Pastebin.pl', active: false },
                    { name: 'quickpaste', label: 'Quickpaste', active: false },
                    { name: 'ghostbin', label: 'Ghostbin', active: false },
                    { name: 'pastesio', label: 'pastes.io', active: false },
                    { name: 'bpast', label: 'bpa.st', active: false },
                    { name: 'telegram', label: 'Telegram', active: false },
                ],
                async init() {
                    // Load source activity status
                    try {
                        const res = await fetch('/api/stats');
                        const data = await res.json();
                        if (data.success && data.data.by_source) {
                            this.sources.forEach(s => {
                                s.active = (data.data.by_source[s.name] || 0) > 0;
                            });
                        }
                    } catch (e) {
                        console.error('Failed to load source status:', e);
                    }
                }
            };
        }
        
        // Global function to toggle modal (called from stats bar)
        function toggleSourcesModal() {
            // Find the Alpine component and toggle it
            const modalEl = document.querySelector('[x-data="sourcesModal()"]');
            if (modalEl && modalEl.__x) {
                modalEl.__x.$data.open = !modalEl.__x.$data.open;
            }
        }
    </script>
</body>
</html>
